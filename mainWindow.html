<!DOCTYPE html>
<html lang="en">
<head>
    <title>ShutdownApp</title>
</head>
<body>
    <h1>ShutdownApp</h1>
    <h2>Pozosta≈Ço: <span id="countdownMinutes"></span> minut <span id="countdownSeconds"></span> sekund.</h2>
    <input type="number" id="timeValueInput" style="width: 50px">
    <select name="time-select" id="timeSelect">
        <option value="minutes">minuty</option>
        <option value="seconds">sekundy</option>
    </select>
    <button id="start">Zacznij</button>
    <button id="abort">Przerwij</button>

    <script>
        'use strict';
        const electron = require('electron');
        const {ipcRenderer} = electron;

        let myInterval;
        
        const startCountdown = (secondsOrHours, timeValueInput) => {
            let currentSecondsLeft;
            if (secondsOrHours === 'minutes') {
                currentSecondsLeft = timeValueInput * 60;
            } else {
                currentSecondsLeft = timeValueInput;
            }
            myInterval = setInterval(() => {
                if (currentSecondsLeft === 0) {
                    updateTimer(currentSecondsLeft);
                    clearInterval(myInterval);
                    sendEvent();
                } else {
                    updateTimer(currentSecondsLeft);
                    currentSecondsLeft --;
                }
            }, 1000);
        };

        const abortCountdown = () => {
            clearInterval(myInterval);
        }

        const updateTimer = (currentSecondsLeft) => {
            const spanMinutes = document.getElementById('countdownMinutes');
            const spanSeconds = document.getElementById('countdownSeconds');
            const minutes = Math.floor(currentSecondsLeft / 60);
            const seconds = (currentSecondsLeft % 60);
            spanMinutes.innerHTML = minutes;
            spanSeconds.innerHTML = seconds;
        }

        const sendEvent = () => {
            ipcRenderer.send('start');
        }

        const startButton = document.getElementById('start');
        startButton.addEventListener('click', (e) => {
            e.preventDefault();
            const item = startButton.innerText;
            const secondsOrHours = document.getElementById('timeSelect').value;
            const timeValueInput = document.getElementById('timeValueInput').value;
            startCountdown(secondsOrHours, timeValueInput);
        });

        const abortButton = document.getElementById('abort');
        abortButton.addEventListener('click', (e) => {
            e.preventDefault();
            const item = startButton.innerText;
            abortCountdown();
        });

    </script>
</body>
</html>