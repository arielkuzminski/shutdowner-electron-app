<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <title>ShutdownApp</title>
</head>
<body>
    <section class="section">
        <div class="wrapper">
            <div class="container">
                <h1 class="title has-text-centered">ShutdownApp</h1>
                <h2 class="subtitle has-text-centered" id="time-left">Pozosta≈Ço: <span id="countdownMinutes"></span> minut <span id="countdownSeconds"></span> sekund.</h2>
            </div>
            <div class="container field has-text-centered">
                <div class="field is-grouped">
                    <p class="control">
                        <input class="input" type="number" placeholder="Time left" id="timeValueInput" min="1">
                    </p>
                    <p class="control">
                        <span class="select">
                            <select id="timeSelect">
                                <option>Minutes</option>
                                <option>Seconds</option>
                            </select>
                        </span>
                    </p>
                </div>
            </div>
            <div class="container field">
                <button class="button is-success" id="start">Start</button>
                <button class="button is-danger" id="abort">Abort</button>
            </div>

        </div>
        <div class="container field">
            <progress class="progress" id="progress" value="15" max="100"></progress>
        </div>
    </section>

    <script>
        'use strict';
        const electron = require('electron');
        const {ipcRenderer} = electron;

        let myInterval;
        
        const startCountdown = (secondsOrHours, timeValueInput) => {
            let currentSecondsLeft;
            let secondsAtStart;
            if (secondsOrHours === 'minutes') {
                currentSecondsLeft = timeValueInput * 60;
            } else {
                currentSecondsLeft = timeValueInput;
            }
            secondsAtStart = currentSecondsLeft;
            myInterval = setInterval(() => {
                console.log(currentSecondsLeft);
                if (currentSecondsLeft === 0) {
                    updateTimer(currentSecondsLeft, secondsAtStart);
                    clearInterval(myInterval);
                    sendEvent();
                } else {
                    currentSecondsLeft--;
                    updateTimer(currentSecondsLeft, secondsAtStart);
                }
            }, 1000);
        };

        const abortCountdown = () => {
            clearInterval(myInterval);
        }

        const updateTimer = (currentSecondsLeft, secondsAtStart) => {
            const spanMinutes = document.getElementById('countdownMinutes');
            const spanSeconds = document.getElementById('countdownSeconds');
            const percentDiv = document.getElementById('percent');
            const progress = document.getElementById('progress');
            const minutes = Math.floor(currentSecondsLeft / 60);
            const seconds = (currentSecondsLeft % 60);
            spanMinutes.innerHTML = minutes;
            spanSeconds.innerHTML = seconds;
            const percent = Math.floor(currentSecondsLeft / secondsAtStart * 100);
            percentDiv.innerHTML = percent;
            progress.value = percent;
        }

        const sendEvent = () => {
            ipcRenderer.send('start');
        }

        const startButton = document.getElementById('start');
        startButton.addEventListener('click', (e) => {
            e.preventDefault();
            const item = startButton.innerText;
            const secondsOrHours = document.getElementById('timeSelect').value;
            const timeValueInput = document.getElementById('timeValueInput').value;
            startCountdown(secondsOrHours, timeValueInput);
        });

        const abortButton = document.getElementById('abort');
        abortButton.addEventListener('click', (e) => {
            e.preventDefault();
            const item = startButton.innerText;
            abortCountdown();
        });

    </script>

    <style>
        .wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-bottom: 10px;
        }
    </style>
</body>
</html>